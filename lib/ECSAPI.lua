local c={["component"]="component",["term"]="term",["unicode"]="unicode",["event"]="event",["fs"]="filesystem",["shell"]="shell",["keyboard"]="keyboard",["computer"]="computer",["serialization"]="serialization"}local d={["gpu"]="gpu"}for e in pairs(c)do if not _G[e]then _G[e]=require(c[e])end end;for f in pairs(d)do if not _G[f]then _G[f]=_G.component[d[f]]end end;c,d=nil,nil;local g={}g.windowColors={background=0xeeeeee,usualText=0x444444,subText=0x888888,tab=0xaaaaaa,title=0xffffff,shadow=0x444444}g.colors={white=0xffffff,orange=0xF2B233,magenta=0xE57FD8,lightBlue=0x99B2F2,yellow=0xDEDE6C,lime=0x7FCC19,pink=0xF2B2CC,gray=0x4C4C4C,lightGray=0x999999,cyan=0x4C99B2,purple=0xB266E5,blue=0x3366CC,brown=0x7F664C,green=0x57A64E,red=0xCC4C4C,black=0x000000,["0"]=0xffffff,["1"]=0xF2B233,["2"]=0xE57FD8,["3"]=0x99B2F2,["4"]=0xDEDE6C,["5"]=0x7FCC19,["6"]=0xF2B2CC,["7"]=0x4C4C4C,["8"]=0x999999,["9"]=0x4C99B2,["a"]=0xB266E5,["b"]=0x3366CC,["c"]=0x7F664C,["d"]=0x57A64E,["e"]=0xCC4C4C,["f"]=0x000000}function g.setScale(h,i)if h>1 then h=1 elseif h<0.1 then h=0.1 end;local function j(k)local l=12;if k==2 then l=28 elseif k>2 then l=28+(k-2)*16 end;return l end;local m,n=component.screen.getAspectRatio()local o,p=j(m),j(n)local q=o/p;local r,s=gpu.maxResolution()local t,u;if q>=1 then t=math.floor(r)u=math.floor(t/q/2)else u=math.floor(s)t=math.floor(u*q*2)end;local v,w=t,u;if v>r then local x=v-r;v=r;w=w-math.ceil(x/2)end;if w>s then local x=w-s;w=s;v=v-x*2 end;local y,z=math.floor(v*h),math.floor(w*h)if i then print(" ")print("Максимальное разрешение: "..r.."x"..s)print("Пропорция монитора: "..o.."x"..p)print("Коэффициент пропорции: "..q)print(" ")print("Теоретическое разрешение: "..t.."x"..u)print("Оптимизированное разрешение: "..v.."x"..w)print(" ")print("Новое разрешение: "..y.."x"..z)print(" ")end;gpu.setResolution(y,z)end;function g.rebindGPU(A)gpu.bind(A)end;function g.getInfoAboutRAM()local B=math.floor(computer.freeMemory()/1024)local C=math.floor(computer.totalMemory()/1024)local D=C-B;return B,C,D end;function g.getHDDs()local E={}for A in component.list("filesystem")do local F=component.proxy(A)if F.address~=computer.tmpAddress()and F.getLabel()~="internet"then local G,H=false,math.floor(F.spaceTotal()/1024)if H<600 then G=true end;table.insert(E,{["spaceTotal"]=H,["spaceUsed"]=math.floor(F.spaceUsed()/1024),["label"]=F.getLabel(),["address"]=F.address,["isReadOnly"]=F.isReadOnly(),["isFloppy"]=G})end end;return E end;function g.formatHDD(A)local F=component.proxy(A)local I=F.list("")g.info("auto","auto","","Formatting disk...")for J,K in pairs(I)do if type(K)=="string"then if not F.isReadOnly(K)then F.remove(K)end end end;I=nil end;function g.setHDDLabel(A,L)local F=component.proxy(A)F.setLabel(L or"Untitled")end;function g.findMount(A)for M,path in fs.mounts()do if M.address==component.get(A)then return path end end end;function g.getArraySize(N)local O=0;for P in pairs(N)do O=O+1 end;return O end;function g.duplicateFileSystem(Q,R)local S,T=g.findMount(Q),g.findMount(R)g.info("auto","auto","","Copying file system...")shell.execute("bin/cp -rx "..S.."* "..T)end;function g.getFileFromUrl(U,path)if not _G.internet then _G.internet=require("internet")end;local V=""local W,X=pcall(internet.request,U)if not W then g.error("Could not connect to to URL address \""..U.."\"")return end;fs.remove(path)fs.makeDirectory(fs.path(path))local K=io.open(path,"w")for Y in X do K:write(Y)V=V..Y end;K:close()return V end;function g.getFromPastebin(Z,path)local U="http://pastebin.com/raw.php?i="..Z;g.getFileFromUrl(U,path)end;function g.getFromGitHub(U,path)U="https://raw.githubusercontent.com/"..U;g.getFileFromUrl(U,path)end;function g.getOSApplication(_)local path=_.name;fs.remove(path)if _.type=="Application"then fs.makeDirectory(path..".app/Resources")g.getFromGitHub(_.url,path..".app/"..fs.name(_.name..".lua"))g.getFromGitHub(_.icon,path..".app/Resources/Icon.pic")if _.resources then for a0=1,#_.resources do g.getFromGitHub(_.resources[a0].url,path..".app/Resources/".._.resources[a0].name)end end else g.getFromGitHub(_.url,path)end end;function g.getAppsToUpdate(i)local a1="MineOS/System/OS/Applications.txt"local a2="MineOS/System/OS/Applications2.txt"local Z="3j2x4dDn"local a3;if i then a3=g.info("auto","auto"," ","Checking for updates...")end;g.getFromPastebin(Z,a2)local K=io.open(a1,"r")local a4=serialization.unserialize(K:read("*a"))K:close()K=io.open(a2,"r")local a5=serialization.unserialize(K:read("*a"))K:close()local a6=0;local a0=1;while true do if a0>#a5 then break end;local a7,a8=a5[a0].version,0;for a9=1,#a4 do if a5[a0].name==a4[a9].name then a8=a4[a9].version or 0;break end end;if a7>a8 then a5[a0].needToUpdate=true;a6=a6+1 end;a0=a0+1 end;if a3 then g.drawOldPixels(a3)end;return a5,a6 end;function g.stringOptimize(aa,ab)ab=ab or 2;aa=string.gsub(aa,"\r\n","\n")aa=string.gsub(aa,"	",string.rep(" ",ab))return stro4ka end;function g.decToBase(ac,ad)local ae="0123456789ABCDEFGHIJKLMNOPQRSTUVW"OUT=""local af=0;while ac>0 do af=math.fmod(ac,ad)+1;ac=math.floor(ac/ad)OUT=string.sub(ae,af,af)..OUT end;if#OUT==1 then OUT="0"..OUT end;if OUT==""then OUT="00"end;return OUT end;function g.HEXtoString(ag,ah,ai)local stro4ka=string.format("%X",ag)local aj=unicode.len(stro4ka)if aj<ah then stro4ka=string.rep("0",ah-aj)..stro4ka end;aj=nil;if ai then return"0x"..stro4ka else return stro4ka end end;function g.clickedAtArea(ak,al,am,an,ao,ap)if ak>=am and ak<=ao and al>=an and al<=ap then return true end;return false end;function g.clearScreen(ag)if ag then gpu.setBackground(ag)end;term.clear()end;function g.setPixel(ak,al,ag)gpu.setBackground(ag)gpu.set(ak,al," ")end;function g.setColor(aq,ar)gpu.setBackground(aq)gpu.setForeground(ar)end;function g.colorText(ak,al,as,at)gpu.setForeground(as)gpu.set(ak,al,at)end;function g.colorTextWithBack(ak,al,as,au,at)gpu.setForeground(as)gpu.setBackground(au)gpu.set(ak,al,at)end;function g.invertColor(ag)return 0xffffff-ag end;function g.adaptiveText(ak,al,at,as)gpu.setForeground(as)ak=ak-1;for a0=1,unicode.len(at)do local av={gpu.get(ak+a0,al)}gpu.setBackground(av[3])gpu.set(ak+a0,al,unicode.sub(at,a0,a0))end end;function unicode.find(aw,ax,ay,az)if ay then if ay<0 then ay=-#unicode.sub(aw,ay)elseif ay>0 then ay=#unicode.sub(aw,1,ay-1)+1 end end;a,b=string.find(aw,ax,ay,az)if a then local aA,aB=aw:sub(1,a-1),aw:sub(a,b)a=unicode.len(aA)+1;b=a+unicode.len(aB)-1;return a,b else return a end end;function g.smartText(ak,al,at)local aC=unicode.len(at)local aD="§"local aE={}local aF=1;local aG=gpu.getForeground()while aF<=aC do local aH=unicode.sub(at,aF,aF)if aH==aD then aG=g.colors[unicode.sub(at,aF+1,aF+1)or"f"]aF=aF+1 else table.insert(aE,{aH,aG})end;aH=nil;aF=aF+1 end;ak=ak-1;for a0=1,#aE do if aG~=aE[a0][2]then aG=aE[a0][2]gpu.setForeground(aE[a0][2])end;gpu.set(ak+a0,al,aE[a0][1])end end;function g.formattedText(ak,al,at,aI)aI=aI or math.huge;local aJ=ak;local aK={}for a0=1,unicode.len(at)do table.insert(aK,unicode.sub(at,a0,a0))end;local a0=1;while a0<=#aK and a0<=aI do if aK[a0]=="§"then gpu.setForeground(tonumber("0x"..aK[a0+1]..aK[a0+2]..aK[a0+3]..aK[a0+4]..aK[a0+5]..aK[a0+6]))aI=aI+7;a0=a0+7 end;gpu.set(aJ,al,aK[a0])aJ=aJ+1;a0=a0+1 end end;function g.invertedText(ak,al,aH)local av={gpu.get(ak,al)}g.adaptiveText(ak,al,aH,g.invertColor(av[3]))end;function g.adaptiveRound(aL)local aM,aN=math.modf(aL)if aN>=0.5 then return aM+1 else return aM end end;function g.round(aO,aP)local aQ=10^(aP or 0)return math.floor(aO*aQ+0.5)/aQ end;function g.square(ak,al,aR,aS,ag)gpu.setBackground(ag)gpu.fill(ak,al,aR,aS," ")end;function g.border(ak,al,aR,aS,aT,aU)local aV="┌"..string.rep("─",aR-2).."┐"local aW="└"..string.rep("─",aR-2).."┘"gpu.setForeground(aU)gpu.setBackground(aT)gpu.set(ak,al,aV)gpu.set(ak,al+aS-1,aW)local aX=1;for a0=1,aS-2 do gpu.set(ak,al+aX,"│")gpu.set(ak+aR-1,al+aX,"│")aX=aX+1 end end;function g.drawFramedButton(ak,al,aR,aS,at,ag)g.border(ak,al,aR,aS,gpu.getBackground(),ag)gpu.fill(ak+1,al+1,aR-2,aS-2," ")ak=ak+math.floor(aR/2-unicode.len(at)/2)al=al+math.floor(aR/2-1)gpu.set(ak,al,at)end;function g.separator(ak,al,aR,aT,aU)g.colorTextWithBack(ak,al,aU,aT,string.rep("─",aR))end;function g.centerText(aY,aZ,at)local a_=unicode.len(at)local b0,b1=gpu.getResolution()if aY=="x"then gpu.set(math.floor(b0/2-a_/2),aZ,at)elseif aY=="y"then gpu.set(aZ,math.floor(b1/2),at)else gpu.set(math.floor(b0/2-a_/2),math.floor(b1/2),at)end end;function g.drawCustomImage(ak,al,b2)ak=ak-1;al=al-1;local b3=#b2[1]local b4=#b2;local b5=ak+b3;local b6=al+b4;for a0=1,b4 do for a9=1,b3 do if b2[a0][a9][3]~="#"then if gpu.getBackground()~=b2[a0][a9][1]then gpu.setBackground(b2[a0][a9][1])end;if gpu.getForeground()~=b2[a0][a9][2]then gpu.setForeground(b2[a0][a9][2])end;gpu.set(ak+a9,al+a0,b2[a0][a9][3])end end end;return ak+1,al+1,b5,b6 end;function g.correctStartCoords(b7,b8,b9,ba)local b0,b1=gpu.getResolution()if b7=="auto"then b7=math.floor(b0/2-b9/2)end;if b8=="auto"then b8=math.ceil(b1/2-ba/2)end;return b7,b8 end;function g.rememberOldPixels(ak,al,bb,bc)local bd={["backgrounds"]={}}local b0,b1=gpu.getResolution()bd.x,bd.y=ak,al;local be,bf=1,1;for a9=al,bc do be=1;for a0=ak,bb do if a0>b0 or a0<0 or(a9>b1 or a9<0)then error("Can't remember pixel, because it's located behind the screen: x("..a0 .."), y("..a9 ..") out of xSize("..b0 .."), ySize("..b1 ..")\n")end;local aH,aU,aT=gpu.get(a0,a9)bd["backgrounds"][aT]=bd["backgrounds"][aT]or{}bd["backgrounds"][aT][aU]=bd["backgrounds"][aT][aU]or{}table.insert(bd["backgrounds"][aT][aU],{be,bf,aH})be=be+1;aT,aU,aH=nil,nil,nil end;bf=bf+1 end;b0,b1=nil,nil;return bd end;function g.drawOldPixels(bg)for aT,bh in pairs(bg["backgrounds"])do gpu.setBackground(aT)for aU,bi in pairs(bg["backgrounds"][aT])do gpu.setForeground(aU)for bj=1,#bg["backgrounds"][aT][aU]do if bg["backgrounds"][aT][aU][bj][3]~=transparentSymbol then gpu.set(bg.x+bg["backgrounds"][aT][aU][bj][1]-1,bg.y+bg["backgrounds"][aT][aU][bj][2]-1,bg["backgrounds"][aT][aU][bj][3])end end end end end;function g.stringLimit(aY,at,O,bk)if unicode.len(at)<=O then return at end;local bl=unicode.len(at)if aY=="start"then if bk then return unicode.sub(at,bl-O+1,-1)else return"…"..unicode.sub(at,bl-O+2,-1)end else if bk then return unicode.sub(at,1,O)else return unicode.sub(at,1,O-1).."…"end end end;function g.getHostTime(bm)bm=bm or 2;local K=io.open("HostTime.tmp","w")K:write("")K:close()local bn=bm*3600;local bo=tonumber(string.sub(fs.lastModified("HostTime.tmp"),1,-4))+bn;fs.remove("HostTime.tmp")local bp,bq,br,bs,bt,bu=os.date("%Y",bo),os.date("%m",bo),os.date("%d",bo),os.date("%H",bo),os.date("%M",bo),os.date("%S",bo)return tonumber(br),tonumber(bq),tonumber(bp),tonumber(bs),tonumber(bt),tonumber(bu)end;function g.getFileList(path)local I=fs.list(path)local aE={}for K in I do table.insert(aE,K)end;I=nil;return aE end;function g.getFileTree(path)local aE={}local I=g.getFileList(path)for P,K in pairs(I)do if fs.isDirectory(path.."/"..K)then table.insert(aE,getFileTree(path.."/"..K))else table.insert(aE,K)end end;I=nil;return aE end;function g.find(path,bv)local bw={}local function bx(path,bv)local I=g.getFileList(path)for P,K in pairs(I)do local by=path..K;if string.find(unicode.lower(K),unicode.lower(bv))then table.insert(bw,by)end;if fs.isDirectory(by)then bx(by,bv)end;by=nil end;I=nil end;bx(path,bv)return bw end;function g.getFileFormat(path)local bz=fs.name(path)local bA,bB=string.find(bz,"(.)%.[%d%w]*$")if bA==nil then return nil else return unicode.sub(bz,bA+1,-1)end;bz,bA,bB=nil,nil,nil end;function g.isFileHidden(path)local bz=fs.name(path)local bA,bB=string.find(bz,"^%.(.*)$")if bA==nil then return false else return true end;bz,bA,bB=nil,nil,nil end;function g.hideFileFormat(path)local bz=fs.name(path)local bC=g.getFileFormat(bz)if bC==nil then return bz else return unicode.sub(bz,1,unicode.len(bz)-unicode.len(bC))end end;function g.waitForTouchOrClick()while true do local bD={event.pull()}if bD[1]=="key_down"or bD[1]=="touch"then break end end end;function g.wait()g.waitForTouchOrClick()end;function g.drawCloses(ak,al,bE)local aH="⮾"g.colorText(ak,al,bE==1 and g.colors.blue or 0xCC4C4C,aH)g.colorText(ak+2,al,bE==2 and g.colors.blue or 0xDEDE6C,aH)g.colorText(ak+4,al,bE==3 and g.colors.blue or 0x57A64E,aH)end;function g.drawTopBar(ak,al,aR,bF,aq,ar,...)local bG={...}g.square(ak,al,aR,3,aq)local bH=0;local bI=2;for a0=1,#bG do bH=bH+unicode.len(bG[a0][1])+bI end;local aJ=ak+math.floor(aR/2-bH/2)for a0=1,#bG do if a0==bF then g.square(aJ,al,unicode.len(bG[a0][1])+bI,3,g.colors.blue)gpu.setForeground(0xffffff)else gpu.setBackground(aq)gpu.setForeground(ar)end;gpu.set(aJ+bI/2,al+2,bG[a0][1])gpu.set(aJ+math.ceil(unicode.len(bG[a0][1])/2),al+1,bG[a0][2])aJ=aJ+unicode.len(bG[a0][1])+bI end end;function g.drawTopMenu(ak,al,aR,ag,bF,...)local bG={...}local bJ={}local aJ=ak+2;local bI=2;g.square(ak,al,aR,1,ag)for a0=1,#bG do if a0==bF then g.square(aJ-1,al,unicode.len(bG[a0][1])+bI,1,g.colors.blue)gpu.setForeground(0xffffff)gpu.set(aJ,al,bG[a0][1])gpu.setForeground(bG[a0][2])gpu.setBackground(ag)else if gpu.getForeground()~=bG[a0][2]then gpu.setForeground(bG[a0][2])end;gpu.set(aJ,al,bG[a0][1])end;bJ[bG[a0][1]]={aJ,al,aJ+unicode.len(bG[a0][1])-1,al,a0}aJ=aJ+unicode.len(bG[a0][1])+bI end;return bJ end;function g.drawButton(ak,al,aR,aS,at,au,as)ak,al=g.correctStartCoords(ak,al,aR,aS)local bK=math.floor(ak+aR/2-unicode.len(at)/2)local bL=math.floor(al+aS/2)g.square(ak,al,aR,aS,au)g.colorText(bK,bL,as,at)return ak,al,ak+aR-1,al+aS-1 end;function g.drawAdaptiveButton(ak,al,bM,bN,at,au,as)local bl=unicode.len(at)local aR=bM*2+bl;local aS=bN*2+1;ak,al=g.correctStartCoords(ak,al,aR,aS)g.square(ak,al,aR,aS,au)g.colorText(ak+bM,al+bN,as,at)return ak,al,ak+aR-1,al+aS-1 end;function g.windowShadow(ak,al,aR,aS)gpu.setBackground(g.windowColors.shadow)gpu.fill(ak+aR,al+1,2,aS," ")gpu.fill(ak+1,al+aS,aR,1," ")end;function g.blankWindow(ak,al,aR,aS)local a3=g.rememberOldPixels(ak,al,ak+aR+1,al+aS)g.square(ak,al,aR,aS,g.windowColors.background)g.windowShadow(ak,al,aR,aS)return a3 end;function g.emptyWindow(ak,al,aR,aS,bO)local a3=g.rememberOldPixels(ak,al,ak+aR+1,al+aS)gpu.setBackground(g.windowColors.background)gpu.fill(ak,al+1,aR,aS-1," ")gpu.setBackground(g.windowColors.tab)gpu.fill(ak,al,aR,1," ")gpu.setForeground(g.windowColors.title)local bK=ak+math.floor(aR/2-unicode.len(bO)/2)-1;gpu.set(bK,al,bO)g.windowShadow(ak,al,aR,aS)return a3 end;function g.stringWrap(bP,aI)local bQ,bR;local a0=1;while a0<=#bP do if unicode.len(bP[a0])>aI then bQ=unicode.sub(bP[a0],1,aI)bR=unicode.sub(bP[a0],aI+1,-1)bP[a0]=bQ;table.insert(bP,a0+1,bR)end;a0=a0+1 end;return bP end;function g.error(...)local bS={...}local at=""if#bS>1 then for a0=1,#bS do if type(bS[a0])=="string"then bS[a0]="\""..bS[a0].."\""end;at=at..tostring(bS[a0])if a0~=#bS then at=at..", "end end else at=tostring(bS[1])end;g.universalWindow("auto","auto",math.ceil(gpu.getResolution()*0.45),g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x880000,"Ошибка!"},{"EmptyLine"},{"WrappedText",0x262626,at},{"EmptyLine"},{"Button",{0x880000,0xffffff,"OK!"}})end;function g.prepareToExit(bT,bU)g.clearScreen(bT or 0x333333)gpu.setForeground(bU or 0xffffff)gpu.set(1,1,"")end;function g.convertCodeToSymbol(bV)local aH;if bV~=0 and bV~=13 and bV~=8 and bV~=9 and bV~=200 and bV~=208 and bV~=203 and bV~=205 and not keyboard.isControlDown()then aH=unicode.char(bV)if keyboard.isShiftPressed then aH=unicode.upper(aH)end end;return aH end;function g.progressBar(ak,al,aR,aS,aq,ar,bW)local bX=math.ceil(aR*bW/100)g.square(ak,al,aR,aS,aq)g.square(ak,al,bX,aS,ar)end;function g.progressWindow(ak,al,aR,bW,at)local aS=6;local bY=aR-6;ak,al=g.correctStartCoords(ak,al,aR,aS)g.emptyWindow(ak,al,aR,aS," ")g.colorTextWithBack(ak+math.floor(aR/2-unicode.len(at)/2),al+4,0x000000,g.windowColors.background,at)g.progressBar(ak+3,al+2,bY,1,0xCCCCCC,g.colors.blue,bW)end;function g.inputText(ak,al,aI,bZ,aq,ar,b_,c0)aI=aI or 10;bZ=bZ or""aq=aq or 0xffffff;ar=ar or 0x000000;gpu.setBackground(aq)gpu.setForeground(ar)gpu.fill(ak,al,aI,1," ")local at=bZ;local function c1()term.setCursorBlink(false)local a_=unicode.len(at)local c2=ak+a_;if c2>ak+aI-1 then c2=ak+aI-1 end;if c0 then gpu.set(ak,al,g.stringLimit("start",string.rep("●",a_),aI))else gpu.set(ak,al,g.stringLimit("start",at,aI))end;term.setCursor(c2,al)term.setCursorBlink(true)end;c1()if b_ then term.setCursorBlink(false)return bZ end;while true do local bD={event.pull()}if bD[1]=="key_down"then if bD[4]==14 then term.setCursorBlink(false)at=unicode.sub(at,1,-2)if unicode.len(at)<aI then gpu.set(ak+unicode.len(at),al," ")end;c1()elseif bD[4]==28 then term.setCursorBlink(false)return at else local aH=g.convertCodeToSymbol(bD[3])if aH then at=at..aH;c1()end end elseif bD[1]=="touch"then term.setCursorBlink(false)return at elseif bD[1]=="clipboard"then if bD[3]then at=at..bD[3]c1()end end end end;function g.parseErrorMessage(error,c3)local c4={}local bA,bB,c5=nil,nil,1;for a0=1,unicode.len(error)do bA,bB=string.find(error,"\n",c5)if bA then table.insert(c4,unicode.sub(error,c5,bA-1))c5=bB+1 else break end end;if#c4==0 and error~=""and error~=nil and error~=" "then table.insert(c4,error)end;for a0=1,#c4 do c4[a0]=string.gsub(c4[a0],"\r\n","\n")c4[a0]=string.gsub(c4[a0],"	","    ")end;if c3 then for a0=1,#c4 do c4[a0]=string.gsub(c4[a0],"interrupted","Выполнение программы прервано пользователем")c4[a0]=string.gsub(c4[a0]," got "," получена ")c4[a0]=string.gsub(c4[a0]," expected,"," ожидается,")c4[a0]=string.gsub(c4[a0],"bad argument #","Неверный аргумент #")c4[a0]=string.gsub(c4[a0],"stack traceback","Отслеживание ошибки")c4[a0]=string.gsub(c4[a0],"tail calls","Дочерние вызовы")c4[a0]=string.gsub(c4[a0],"in function","в функции")c4[a0]=string.gsub(c4[a0],"in main chunk","в основной программе")c4[a0]=string.gsub(c4[a0],"unexpected symbol near","неожиданный символ рядом с")c4[a0]=string.gsub(c4[a0],"attempt to index","пытаюсь получить значение индекса массива")c4[a0]=string.gsub(c4[a0],"attempt to get length of","не удается получить длину")c4[a0]=string.gsub(c4[a0],": ",", ")c4[a0]=string.gsub(c4[a0]," module "," модуль ")c4[a0]=string.gsub(c4[a0],"not found","не найден")c4[a0]=string.gsub(c4[a0],"no field package.preload","не найдена библиотека")c4[a0]=string.gsub(c4[a0],"no file","нет файла")c4[a0]=string.gsub(c4[a0],"local","локальной")c4[a0]=string.gsub(c4[a0],"global","глобальной")c4[a0]=string.gsub(c4[a0],"no primary","не найден компонент")c4[a0]=string.gsub(c4[a0],"available","в доступе")c4[a0]=string.gsub(c4[a0],"attempt to concatenate","не могу присоединить")c4[a0]=string.gsub(c4[a0],"a nil value","переменная равна nil")end end;bA,bB=nil,nil;return c4 end;function g.displayCompileMessage(al,c6,c3,c7)local b0,b1=gpu.getResolution()c6=g.parseErrorMessage(c6,c3)local aR=math.floor(b0*7/10)local c8=aR-11;c6=g.stringWrap(c6,c8)local aS=#c6+6;local x=b1-(aS+al)if x<0 then for a0=1,math.abs(x)+1 do table.remove(c6,#c6)end;table.insert(c6,"…")aS=#c6+6 end;local ak=math.floor(b0/2-aR/2)local c9={{{0xff0000,0xffffff,"#"},{0xff0000,0xffffff,"#"},{0xff0000,0xffffff," "},{0xff0000,0xffffff,"#"},{0xff0000,0xffffff,"#"}},{{0xff0000,0xffffff,"#"},{0xff0000,0xffffff," "},{0xff0000,0xffffff,"!"},{0xff0000,0xffffff," "},{0xff0000,0xffffff,"#"}},{{0xff0000,0xffffff," "},{0xff0000,0xffffff," "},{0xff0000,0xffffff," "},{0xff0000,0xffffff," "},{0xff0000,0xffffff," "}}}local a3;local function ca(al)g.square(ak,al,aR,aS,g.windowColors.background)g.windowShadow(ak,al,aR,aS)g.drawCustomImage(ak+2,al+1,c9)local aX=al+1;local aJ=ak+9;gpu.setBackground(g.windowColors.background)g.colorText(aJ,aX,g.windowColors.usualText,"Код ошибки:")aX=aX+2;gpu.setForeground(0xcc0000)for a0=1,#c6 do gpu.set(aJ,aX,c6[a0])aX=aX+1 end;aX=aX+1;g.colorText(aJ,aX,g.windowColors.usualText,g.stringLimit("end","Нажмите любую клавишу, чтобы продолжить",c8))end;if c7 then a3=g.rememberOldPixels(ak,1,ak+aR+1,aS+1)for a0=-aS,1,1 do ca(a0)os.sleep(0.01)end else a3=g.rememberOldPixels(ak,al,ak+aR+1,al+aS)ca(al)end;for a0=1,3 do computer.beep(1000)end;g.wait()g.drawOldPixels(a3)end;function g.askForReplaceFile(path)if fs.exists(path)then local cb=g.universalWindow("auto","auto",46,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x262626,"Файл \""..fs.name(path).."\" уже имеется в этом месте."},{"CenterText",0x262626,"Заменить его перемещаемым объектом?"},{"EmptyLine"},{"Button",{0xdddddd,0x262626,"Оставить оба"},{0xffffff,0x262626,"Отмена"},{g.colors.lightBlue,0xffffff,"Заменить"}})if cb[1]=="Оставить оба"then return"keepBoth"elseif cb[2]=="Отмена"then return"cancel"else return"replace"end end end;function g.checkName(bz,path)if bz==""or bz==" "or bz==nil then g.error("Неверное имя файла.")return false else if fs.exists(path..bz)then g.error("Файл \""..bz.."\" уже имеется в этом месте.")return false else return true end end end;function g.rename(cc)local bz=fs.name(cc)path=fs.path(cc)local cd=g.universalWindow("auto","auto",30,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x262626,"Переименовать"},{"EmptyLine"},{"Input",0x262626,0x880000,bz},{"EmptyLine"},{"Button",{0xbbbbbb,0xffffff,"OK"}})if g.checkName(cd[1],path)then fs.rename(cc,path..cd[1])end end;function g.newFolder(path)local cd=g.universalWindow("auto","auto",30,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x262626,"Новая папка"},{"EmptyLine"},{"Input",0x262626,0x880000,""},{"EmptyLine"},{"Button",{0xbbbbbb,0xffffff,"OK"}})if g.checkName(cd[1],path)then fs.makeDirectory(path..cd[1])end end;function g.newFile(path)local cd=g.universalWindow("auto","auto",30,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x262626,"Новый файл"},{"EmptyLine"},{"Input",0x262626,0x880000,""},{"EmptyLine"},{"Button",{0xbbbbbb,0xffffff,"OK"}})if g.checkName(cd[1],path)then g.prepareToExit()g.editFile(path..cd[1])end end;function g.newApplication(path,ce)local cd;if not ce then cd=g.universalWindow("auto","auto",30,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x262626,"Новое приложение"},{"EmptyLine"},{"Input",0x262626,0x880000,"Введите имя"},{"EmptyLine"},{"Button",{0xbbbbbb,0xffffff,"OK"}})end;if g.checkName(cd[1]..".app",path)then local bz=path..cd[1]..".app/Resources/"fs.makeDirectory(bz)fs.copy("MineOS/System/OS/Icons/SampleIcon.pic",bz.."Icon.pic")local K=io.open(path..cd[1]..".app/"..cd[1]..".lua","w")K:write("local ecs = require(\"ECSAPI\")","\n")K:write("ecs.universalWindow(\"auto\", \"auto\", 30, 0xeeeeee, true, {\"EmptyLine\"}, {\"CenterText\", 0x262626, \"Hello world!\"}, {\"EmptyLine\"}, {\"Button\", {0x880000, 0xffffff, \"Hello!\"}})","\n")K:close()end end;function g.newApplicationFromLuaFile(cf,cg)local ch=g.universalWindow("auto","auto",30,g.windowColors.background,true,{"EmptyLine"},{"CenterText",0x000000,"Новое приложение"},{"EmptyLine"},{"Input",0x262626,0x880000,"Имя приложения"},{"Input",0x262626,0x880000,"Путь к иконке приложения"},{"EmptyLine"},{"Button",{0xbbbbbb,0xffffff,"OK"}})ch[1]=ch[1]or"MyApplication"ch[2]=ch[2]or"MineOS/System/OS/Icons/SampleIcon.pic"if fs.exists(ch[2])then fs.makeDirectory(cg.."/"..ch[1]..".app/Resources")fs.copy(cf,cg.."/"..ch[1]..".app/"..ch[1]..".lua")fs.copy(ch[2],cg.."/"..ch[1]..".app/Resources/Icon.pic")else g.error("Указанный файл иконки не существует.")return end end;function g.info(ak,al,bO,at)ak=ak or"auto"al=al or"auto"bO=bO or" "at=at or"Sample text"local aR=unicode.len(at)+4;local aS=4;ak,al=g.correctStartCoords(ak,al,aR,aS)local a3=g.rememberOldPixels(ak,al,ak+aR+1,al+aS)g.emptyWindow(ak,al,aR,aS,bO)g.colorTextWithBack(ak+2,al+2,g.windowColors.usualText,g.windowColors.background,at)return a3 end;function g.srollBar(ak,al,aR,aS,ci,cj,au,ck)local cl=math.ceil(1/ci*aS)local cm=math.floor(al+aS*(cj-1)/ci)g.square(ak,al,aR,aS,au)g.square(ak,cm,aR,cl,ck)cl,cm=nil,nil end;function g.textField(ak,al,aR,aS,cn,co,aq,ar,cp,cq)ak,al=g.correctStartCoords(ak,al,aR,aS)aq=aq or 0xffffff;ar=ar or g.windowColors.usualText;local cr=#cn;local cs=aR-3;local ct=1;while cn[ct]do local cu=unicode.len(cn[ct])if cu>cs then local cv,cw=unicode.sub(cn[ct],1,cs),unicode.sub(cn[ct],cs+1,-1)cn[ct]=cv;table.insert(cn,ct+1,cw)cv,cw=nil,nil end;ct=ct+1;cu=nil end;ct=nil;g.square(ak,al,aR-1,aS,aq)g.srollBar(ak+aR-1,al,1,aS,cr,co,cp,cq)gpu.setBackground(aq)gpu.setForeground(ar)local aX=al;for a0=co,co+aS-1 do if cn[a0]then gpu.set(ak+1,aX,cn[a0])aX=aX+1 else break end end;return cr end;function g.getCorrectLangName(cx)local cy=_G.OSSettings.language..".lang"if not fs.exists(cx.."/"..cy)then cy="English.lang"end;return cy end;function g.readCorrectLangFile(cx)local cz;local cy=g.getCorrectLangName(cx)cz=config.readAll(cx.."/"..cy)return cz end;function g.sortFiles(path,cA,cB,cC)local cD={}if cB=="type"then local cE={}for a0=1,#cA do local bC=g.getFileFormat(cA[a0])or"Script"if fs.isDirectory(path..cA[a0])and bC~=".app"then bC="Folder"end;cE[bC]=cE[bC]or{}table.insert(cE[bC],cA[a0])end;if cE["Folder"]then for a0=1,#cE["Folder"]do table.insert(cD,cE["Folder"][a0])end;cE["Folder"]=nil end;for bC in pairs(cE)do for a0=1,#cE[bC]do table.insert(cD,cE[bC][a0])end end elseif cB=="name"then cD=cA elseif cB=="date"then for a0=1,#cA do cA[a0]={cA[a0],fs.lastModified(path..cA[a0])}end;table.sort(cA,function(a,b)return a[2]>b[2]end)for a0=1,#cA do table.insert(cD,cA[a0][1])end else error("Unknown sorting method")end;local a0=1;while a0<=#cD do if not cC and g.isFileHidden(cD[a0])then table.remove(cD,a0)else a0=a0+1 end end;return cD end;function g.saveOSSettings()local cF="MineOS/System/OS/OSSettings.cfg"if not _G.OSSettings then error("Массив настроек ОС отсутствует в памяти!")end;fs.makeDirectory(fs.path(cF))local K=io.open(cF,"w")K:write(serialization.serialize(_G.OSSettings))K:close()end;function g.loadOSSettings()local cF="MineOS/System/OS/OSSettings.cfg"if fs.exists(cF)then local K=io.open(cF,"r")_G.OSSettings=serialization.unserialize(K:read("*a"))K:close()else _G.OSSettings={showHelpOnApplicationStart=true,language="Russian"}g.saveOSSettings()end end;function g.applicationHelp(cG)local cH=cG.."/resources/About.txt"if _G.OSSettings and _G.OSSettings.showHelpOnApplicationStart and fs.exists(cH)then local cI=fs.name(cG)local K=io.open(cH,"r")local at=""for ct in K:lines()do at=at..ct.." "end;K:close()local ch=g.universalWindow("auto","auto",30,0xeeeeee,true,{"EmptyLine"},{"CenterText",0x000000,"О приложении "..cI},{"EmptyLine"},{"TextField",16,0xFFFFFF,0x262626,0xcccccc,0x353535,at},{"EmptyLine"},{"Button",{g.colors.orange,0x262626,"OK"},{0x999999,0xffffff,"Больше не показывать"}})if ch[1]~="OK"then _G.OSSettings.showHelpOnApplicationStart=false;g.saveOSSettings()end end end;function g.createShortCut(path,cJ)fs.remove(path)fs.makeDirectory(fs.path(path))local K=io.open(path,"w")K:write("return ","\"",cJ,"\"")K:close()end;function g.readShortcut(path)local cK,cL=pcall(loadfile(path))if cK then return cL else error("Ошибка чтения файла ярлыка. Вероятно, он создан криво, либо не существует в папке "..path)end end;function g.editFile(path)g.prepareToExit()shell.execute("edit "..path)end;function g.copyFolder(path,cM)local function cN(path)local cA=g.getFileList(path)for a0=1,#cA do if fs.isDirectory(path..cA[a0])then cN(path..cA[a0])else fs.makeDirectory(cM..path)fs.copy(path..cA[a0],cM..path..cA[a0])end end end;cM=fs.path(cM)cN(path.."/")end;function g.copy(cO,cP)local bz=fs.name(cO)local cQ=cP.."/"..bz;local cb=g.askForReplaceFile(cQ)if cb==nil or cb=="replace"then fs.remove(cQ)if fs.isDirectory(cO)then g.copyFolder(cO,cQ)else fs.copy(cO,cQ)end elseif cb=="keepBoth"then if fs.isDirectory(cO)then g.copyFolder(cO,cP.."/(copy)"..bz)else fs.copy(cO,cP.."/(copy)"..bz)end end end;g.OSIconsWidth=12;g.OSIconsHeight=6;local function cR()if not _G.image then _G.image=require("image")end;if not _G.buffer then _G.buffer=require("doubleBuffering")end;if not g.OSIcons then g.OSIcons={}g.pathToIcons="MineOS/System/OS/Icons/"g.OSIcons.folder=image.load(g.pathToIcons.."Folder.pic")g.OSIcons.script=image.load(g.pathToIcons.."Script.pic")g.OSIcons.text=image.load(g.pathToIcons.."Text.pic")g.OSIcons.config=image.load(g.pathToIcons.."Config.pic")g.OSIcons.lua=image.load(g.pathToIcons.."Lua.pic")g.OSIcons.image=image.load(g.pathToIcons.."Image.pic")g.OSIcons.imageJPG=image.load(g.pathToIcons.."RawImage.pic")g.OSIcons.pastebin=image.load(g.pathToIcons.."Pastebin.pic")g.OSIcons.fileNotExists=image.load(g.pathToIcons.."FileNotExists.pic")g.OSIcons.archive=image.load(g.pathToIcons.."Archive.pic")end end;function g.drawOSIcon(ak,al,path,cS,cT)cR()local bC=g.getFileFormat(path)local cU;if fs.isDirectory(path)then if bC==".app"then cU=path.."/Resources/Icon.pic"if not g.OSIcons[cU]then g.OSIcons[cU]=image.load(cU)end else cU="folder"end else if bC==".lnk"then local cV=g.readShortcut(path)g.drawOSIcon(ak,al,cV,cS,cT)buffer.set(ak+g.OSIconsWidth-3,al+g.OSIconsHeight-3,0xFFFFFF,0x000000,"<")return 0 elseif bC==".cfg"or bC==".config"then cU="config"elseif bC==".txt"or bC==".rtf"then cU="text"elseif bC==".lua"then cU="lua"elseif bC==".pic"or bC==".png"then cU="image"elseif bC==".rawpic"then cU="imageJPG"elseif bC==".paste"then cU="pastebin"elseif bC==".pkg"then cU="archive"elseif not fs.exists(path)then cU="fileNotExists"else cU="script"end end;buffer.image(ak+2,al,g.OSIcons[cU])local at=fs.name(path)if not cS and bC then at=unicode.sub(at,1,-(unicode.len(bC)+1))end;at=g.stringLimit("end",at,g.OSIconsWidth)local cW=ak+math.floor(g.OSIconsWidth/2-unicode.len(at)/2)buffer.text(cW,al+g.OSIconsHeight-1,cT or 0xffffff,at)end;function g.launchIcon(path,cX)local c7=false;local c3=true;local cY,cZ=gpu.getResolution()if cX then cX=" "..cX else cX=""end;local bC=g.getFileFormat(path)local c_=fs.isDirectory(path)if bC==".app"then g.applicationHelp(path)local d0=path.."/"..g.hideFileFormat(fs.name(path))..".lua"local cK,c6=shell.execute(d0)if not cK then g.displayCompileMessage(1,c6,c3,c7)end elseif(bC==""or bC==nil)and c_ then shell.execute("MineOS/Applications/Finder.app/Finder.lua "..path)elseif bC==".lua"or bC==nil then g.prepareToExit()local cK,c6=shell.execute(path..cX)if cK then print(" ")print("Program sucessfully executed. Press any key to continue.")print(" ")else g.displayCompileMessage(1,c6,c3,c7)end elseif bC==".pic"then shell.execute("MineOS/Applications/Photoshop.app/Photoshop.lua open "..path)elseif bC==".raw"then shell.execute("MineOS/Applications/Photoshop.app/Photoshop.lua open "..path)elseif bC==".txt"or bC==".cfg"or bC==".lang"then g.prepareToExit()shell.execute("edit "..path)elseif bC==".lnk"then local cV=g.readShortcut(path)if fs.exists(cV)then g.launchIcon(cV)else g.error("File from shortcut link doesn't exists.")end elseif bC==".paste"then local cV=g.readShortcut(path)g.prepareToExit()local cK,c6=shell.execute("pastebin run "..cV)if cK then print(" ")print("Program sucessfully executed. Press any key to continue.")g.waitForTouchOrClick()else g.displayCompileMessage(1,c6,c3,c7)end elseif bC==".zip"then zip.unarchive(path,fs.path(path)or"")end;gpu.setResolution(cY,cZ)end;function g.universalWindow(ak,al,aR,aq,d1,...)local bG={...}local d2=#bG;local d3;local d4;local d5={["button"]=3,["centertext"]=1,["emptyline"]=1,["input"]=3,["slider"]=3,["select"]=3,["selector"]=3,["separator"]=1,["switch"]=1,["color"]=3}local function d6(d7)aR=math.max(aR,d7)end;for a0=1,d2 do local d8=string.lower(bG[a0][1])if d8=="centertext"then d6(unicode.len(bG[a0][3])+2)elseif d8=="slider"then d6(unicode.len(bG[a0][7]..tostring(bG[a0][5].." "))+2)elseif d8=="select"then for a9=4,#bG[a0]do d6(unicode.len(bG[a0][a9])+2)end elseif d8=="textfield"then d6(5)elseif d8=="wrappedtext"then d6(6)elseif d8=="button"then local d9=0;local da=0;for a9=2,#bG[a0]do da=math.max(da,unicode.len(bG[a0][a9][3])+2)end;d9=da*#bG[a0]d6(d9)elseif d8=="switch"then local a_=unicode.len(bG[a0][5])+2+10+4;d6(a_)elseif d8=="color"then d6(unicode.len(bG[a0][2])+6)end end;local aS=0;for a0=1,d2 do local d8=string.lower(bG[a0][1])if d8=="select"then aS=aS+d5[d8]*(#bG[a0]-3)elseif d8=="textfield"then aS=aS+bG[a0][2]elseif d8=="wrappedtext"then bG[a0].wrapped=g.stringWrap({bG[a0][3]},aR-4)bG[a0].height=#bG[a0].wrapped;aS=aS+bG[a0].height else aS=aS+d5[d8]end end;ak,al=g.correctStartCoords(ak,al,aR,aS)local a3,db,dc;if d1 then db=gpu.getBackground()dc=gpu.getForeground()a3=g.rememberOldPixels(ak,al,ak+aR-1,al+aS-1)end;bG[1].y=al;if d2>1 then for a0=2,d2 do local d8=string.lower(bG[a0-1][1])if d8=="select"then bG[a0].y=bG[a0-1].y+d5[d8]*(#bG[a0-1]-3)elseif d8=="textfield"then bG[a0].y=bG[a0-1].y+bG[a0-1][2]elseif d8=="wrappedtext"then bG[a0].y=bG[a0-1].y+bG[a0-1].height else bG[a0].y=bG[a0-1].y+d5[d8]end end end;local dd={}local function de(df,bz,...)dd[df]=dd[df]or{}dd[df][bz]={...}end;local function dg(dh,bE)local d8=string.lower(bG[dh][1])if d8=="centertext"then local aJ=ak+math.floor(aR/2-unicode.len(bG[dh][3])/2)gpu.setForeground(bG[dh][2])gpu.setBackground(aq)gpu.set(aJ,bG[dh].y,bG[dh][3])elseif d8=="input"then if bE then g.border(ak+1,bG[dh].y,aR-2,d5.input,aq,bG[dh][3])bG[dh][4]=g.inputText(ak+3,bG[dh].y+1,aR-6,"",aq,bG[dh][3],false,bG[dh][5])else g.border(ak+1,bG[dh].y,aR-2,d5.input,aq,bG[dh][2])gpu.set(ak+3,bG[dh].y+1,g.stringLimit("start",bG[dh][4],aR-6))g.inputText(ak+3,bG[dh].y+1,aR-6,bG[dh][4],aq,bG[dh][2],true,bG[dh][5])end;de("Inputs",dh,ak+1,bG[dh].y,ak+aR-2,bG[dh].y+2)elseif d8=="slider"then local di=aR-2;local dj=ak+1;local dk=bG[dh].y+1;local dl=bG[dh][5]-bG[dh][4]local dm=bG[dh][7]local dn=di/dl;local dp=math.floor(dn*bG[dh][6])if dj+dp>dj+di-1 then dp=di-2 end;g.separator(dj,dk,dp,aq,bG[dh][3])g.separator(dj+dp,dk,di-dp,aq,bG[dh][2])g.square(dj+dp,dk,2,1,bG[dh][3])if dm then local at=dm..tostring(bG[dh][6])..(bG[dh][8]or"")local cW=dj+di/2-unicode.len(at)/2;g.square(ak,dk+1,aR,1,aq)g.colorText(cW,dk+1,bG[dh][2],at)end;de("Sliders",dh,dj,dk,ak+di,dk,dn)elseif d8=="select"then local dq=bG[dh][2]local dr=bG[dh][3]bG[dh].selectedData=bG[dh].selectedData or 1;local aH="✔"local aX=bG[dh].y;for a0=4,#bG[dh]do g.border(ak+1,aX,5,3,aq,dq)gpu.set(ak+7,aX+1,bG[dh][a0])if bG[dh].selectedData==a0-3 then g.colorText(ak+3,aX+1,dr,aH)else gpu.set(ak+3,aX+1,"  ")end;dd["Selects"]=dd["Selects"]or{}dd["Selects"][dh]=dd["Selects"][dh]or{}dd["Selects"][dh][a0-3]={ak+1,aX,ak+aR-2,aX+2}aX=aX+d5.select end elseif d8=="selector"then local ds=bG[dh][2]local dt=bG[dh][3]local du=aR-2;bG[dh].selectedElement=bG[dh].selectedElement or bG[dh][4]local dv="┌"..string.rep("─",du-6).."┬───┐"local dw="│"..string.rep(" ",du-6).."│   │"local dx="└"..string.rep("─",du-6).."┴───┘"local aX=bG[dh].y;local function dy(ds)gpu.setBackground(aq)gpu.setForeground(ds)gpu.set(ak+1,bG[dh].y,dv)gpu.set(ak+1,bG[dh].y+1,dw)gpu.set(ak+1,bG[dh].y+2,dx)gpu.set(ak+3,bG[dh].y+1,g.stringLimit("start",bG[dh].selectedElement,aR-6))g.colorText(ak+aR-4,bG[dh].y+1,dt,"▼")end;dy(ds)if bE then local aJ,aX=ak+1,bG[dh].y+3;local dz=aR-2;local dA=#bG[dh]-3;local dB=dA+1;local a3=g.rememberOldPixels(aJ,aX,aJ+dz-1,aX+dB-1)local dC={}dy(dt)local dv="├"..string.rep("─",dz-6).."┴───┤"local dw="│"..string.rep(" ",dz-2).."│"local dx="└"..string.rep("─",du-2).."┘"g.colorTextWithBack(aJ,aX-1,dt,aq,dv)for a0=1,dB-1 do gpu.set(aJ,aX+a0-1,dw)end;gpu.set(aJ,aX+dB-1,dx)aJ=aJ+2;for a0=1,dA do g.colorText(aJ,aX,ds,g.stringLimit("start",bG[dh][a0+3],dz-4))dC[a0]={aJ-1,aX,aJ+dz-4,aX}aX=aX+1 end;local dD;while true do if dD then break end;local bD={event.pull()}if bD[1]=="touch"then for a0=1,#dC do if g.clickedAtArea(bD[3],bD[4],dC[a0][1],dC[a0][2],dC[a0][3],dC[a0][4])then g.square(dC[a0][1],dC[a0][2],dz-2,1,g.colors.blue)g.colorText(dC[a0][1]+1,dC[a0][2],0xffffff,bG[dh][a0+3])os.sleep(0.3)bG[dh].selectedElement=bG[dh][a0+3]dD=true;break end end end end;g.drawOldPixels(a3)end;de("Selectors",dh,ak+1,bG[dh].y,ak+aR-2,bG[dh].y+2)elseif d8=="separator"then g.separator(ak,bG[dh].y,aR,aq,bG[dh][2])elseif d8=="textfield"then de("TextFields",dh,ak+1,bG[dh].y,ak+aR-2,bG[dh].y+bG[dh][2]-1)if not bG[dh].strings then bG[dh].strings=g.stringWrap({bG[dh][7]},aR-3)end;bG[dh].displayFrom=bG[dh].displayFrom or 1;g.textField(ak,bG[dh].y,aR,bG[dh][2],bG[dh].strings,bG[dh].displayFrom,bG[dh][3],bG[dh][4],bG[dh][5],bG[dh][6])elseif d8=="wrappedtext"then gpu.setBackground(aq)gpu.setForeground(bG[dh][2])for a0=1,#bG[dh].wrapped do gpu.set(ak+2,bG[dh].y+a0-1,bG[dh].wrapped[a0])end elseif d8=="button"then dd["MultiButtons"]=dd["MultiButtons"]or{}dd["MultiButtons"][dh]={}local dE=math.floor(aR/(#bG[dh]-1))local aJ,aX=ak,bG[dh].y;for a0=1,#bG[dh]do if type(bG[dh][a0])=="table"then local dF,dG,bb,bc=g.drawButton(aJ,aX,dE,3,bG[dh][a0][3],bG[dh][a0][1],bG[dh][a0][2])table.insert(dd["MultiButtons"][dh],{dF,dG,bb,bc,dE})aJ=bb+1;if a0==#bG[dh]then g.square(aJ,aX,ak+aR-aJ,3,bG[dh][a0][1])dd["MultiButtons"][dh][a0-1][5]=dd["MultiButtons"][dh][a0-1][5]+ak+aR-aJ end;dF,dG,bb,bc=nil,nil,nil,nil end end elseif d8=="switch"then local aJ,aX=ak+2,bG[dh].y;local dH,dI,as,at,dJ=bG[dh][2],bG[dh][3],bG[dh][4],bG[dh][5],bG[dh][6]local dK=8;g.colorTextWithBack(aJ,aX,as,aq,at)aJ=ak+aR-dK-2;if dJ then g.square(aJ,aX,dK,1,dH)g.square(aJ+dK-2,aX,2,1,dI)else g.square(aJ,aX,dK,1,dI-0x444444)g.square(aJ,aX,2,1,dI)end;de("Switches",dh,aJ,aX,aJ+dK-1,aX)elseif d8=="color"then local aJ,aX=ak+1,bG[dh].y;local dL=require("colorlib").alphaBlend(bG[dh][3],0xFFFFFF,180)local dM=aR-2;g.colorTextWithBack(aJ,aX+2,dL,aq,string.rep("▀",dM))g.colorText(aJ,aX,bG[dh][3],string.rep("▄",dM))g.square(aJ,aX+1,dM,1,bG[dh][3])g.colorText(aJ+1,aX+1,0xffffff-bG[dh][3],bG[dh][2])de("Colors",dh,aJ,aX,ak+aR-2,aX+2)end end;local function dN()for a0=1,d2 do dg(a0)end end;local function dO()local aE={}for a0=1,d2 do local type=string.lower(bG[a0][1])if type=="button"then table.insert(aE,d3)elseif type=="input"then table.insert(aE,bG[a0][4])elseif type=="select"then table.insert(aE,bG[a0][bG[a0].selectedData+3])elseif type=="selector"then table.insert(aE,bG[a0].selectedElement)elseif type=="slider"then table.insert(aE,bG[a0][6])elseif type=="switch"then table.insert(aE,bG[a0][6])elseif type=="color"then table.insert(aE,bG[a0][3])else table.insert(aE,nil)end end;return aE end;local function dP()if d1 then g.drawOldPixels(a3)gpu.setBackground(db)gpu.setForeground(dc)end end;g.square(ak,al,aR,aS,aq)dN()while true do local bD={event.pull()}if bD[1]=="touch"or bD[1]=="drag"then if dd["MultiButtons"]then for P in pairs(dd["MultiButtons"])do for a0=1,#dd["MultiButtons"][P]do if g.clickedAtArea(bD[3],bD[4],dd["MultiButtons"][P][a0][1],dd["MultiButtons"][P][a0][2],dd["MultiButtons"][P][a0][3],dd["MultiButtons"][P][a0][4])then g.drawButton(dd["MultiButtons"][P][a0][1],dd["MultiButtons"][P][a0][2],dd["MultiButtons"][P][a0][5],3,bG[P][a0+1][3],bG[P][a0+1][2],bG[P][a0+1][1])os.sleep(0.3)d3=bG[P][a0+1][3]dP()return dO()end end end end;if dd["Inputs"]then for P in pairs(dd["Inputs"])do if g.clickedAtArea(bD[3],bD[4],dd["Inputs"][P][1],dd["Inputs"][P][2],dd["Inputs"][P][3],dd["Inputs"][P][4])then dg(P,true)dg(P)break end end end;if dd["Selects"]then for P in pairs(dd["Selects"])do for a0 in pairs(dd["Selects"][P])do if g.clickedAtArea(bD[3],bD[4],dd["Selects"][P][a0][1],dd["Selects"][P][a0][2],dd["Selects"][P][a0][3],dd["Selects"][P][a0][4])then bG[P].selectedData=a0;dg(P)break end end end end;if dd["Selectors"]then for P in pairs(dd["Selectors"])do if g.clickedAtArea(bD[3],bD[4],dd["Selectors"][P][1],dd["Selectors"][P][2],dd["Selectors"][P][3],dd["Selectors"][P][4])then dg(P,true)dg(P)break end end end;if dd["Sliders"]then for P in pairs(dd["Sliders"])do if g.clickedAtArea(bD[3],bD[4],dd["Sliders"][P][1],dd["Sliders"][P][2],dd["Sliders"][P][3],dd["Sliders"][P][4])then local dj,dn=dd["Sliders"][P][1],dd["Sliders"][P][5]local dQ=bD[3]-dj;local dR=math.floor(dQ/dn)if bD[3]==dd["Sliders"][P][3]then dR=bG[P][5]end;bG[P][6]=dR or bG[P][6]dg(P)break end end end;if dd["Switches"]then for P in pairs(dd["Switches"])do if g.clickedAtArea(bD[3],bD[4],dd["Switches"][P][1],dd["Switches"][P][2],dd["Switches"][P][3],dd["Switches"][P][4])then bG[P][6]=not bG[P][6]dg(P)break end end end;if dd["Colors"]then for P in pairs(dd["Colors"])do if g.clickedAtArea(bD[3],bD[4],dd["Colors"][P][1],dd["Colors"][P][2],dd["Colors"][P][3],dd["Colors"][P][4])then local dS=bG[P][3]bG[P][3]=0xffffff-bG[P][3]dg(P)os.sleep(0.3)bG[P][3]=dS;dg(P)local ag=loadfile("lib/palette.lua")().draw("auto","auto",bG[P][3])bG[P][3]=ag or dS;dg(P)break end end end elseif bD[1]=="scroll"then if dd["TextFields"]then for P in pairs(dd["TextFields"])do if g.clickedAtArea(bD[3],bD[4],dd["TextFields"][P][1],dd["TextFields"][P][2],dd["TextFields"][P][3],dd["TextFields"][P][4])then if bD[5]==1 then if bG[P].displayFrom>1 then bG[P].displayFrom=bG[P].displayFrom-1;dg(P)end else if bG[P].displayFrom<#bG[P].strings then bG[P].displayFrom=bG[P].displayFrom+1;dg(P)end end end end end elseif bD[1]=="key_down"then if bD[4]==28 then dP()return dO()end end end end;function g.demoWindow()g.prepareToExit()local ch=g.universalWindow("auto","auto",36,0xeeeeee,true,{"EmptyLine"},{"CenterText",0x880000,"Здорово, ебана!"},{"EmptyLine"},{"Input",0x262626,0x880000,"Сюда вводить можно"},{"Selector",0x262626,0x880000,"Выбор формата","PNG","JPG","GIF","PSD"},{"EmptyLine"},{"WrappedText",0x262626,"Тест автоматического переноса букв в зависимости от ширины данного окна. Пока что тупо режет на куски, не особо красиво."},{"EmptyLine"},{"Select",0x262626,0x880000,"Я пидор","Я не пидор"},{"Slider",0x262626,0x880000,1,100,50,"Убито "," младенцев"},{"EmptyLine"},{"Separator",0xaaaaaa},{"Switch",0xF2B233,0xffffff,0x262626,"✈ Авиарежим",false},{"EmptyLine"},{"Switch",0x3366CC,0xffffff,0x262626,"☾  Не беспокоить",true},{"Separator",0xaaaaaa},{"EmptyLine"},{"TextField",5,0xffffff,0x262626,0xcccccc,0x3366CC,"Тест текстового информационного поля. По сути это тот же самый WrappedText, разве что эта хрень ограничена по высоте, и ее можно скроллить. Ну же, поскролль меня! Скролль меня полностью! Моя жадная пизда жаждет твой хуй!"},{"Color","Цвет фона",0xFF0000},{"EmptyLine"},{"Button",{0x57A64E,0xffffff,"Да"},{0xF2B233,0xffffff,"Нет"},{0xCC4C4C,0xffffff,"Отмена"}})g.prepareToExit()print(" ")print("Вывод данных из окна:")for a0=1,#ch do print("["..a0 .."] = "..tostring(ch[a0]))end;print(" ")end;return g
